<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"  
    xmlns:h="http://java.sun.com/jsf/html"  
    xmlns:f="http://java.sun.com/jsf/core" 
	xmlns:ui="http://java.sun.com/jsf/facelets"  
    xmlns:p="http://primefaces.org/ui">  
         
	<h:head>  
		<link rel="stylesheet" type="text/css" href="#{request.contextPath}/css/common.css"/>
		<h:outputScript library="js" name="#{request.contextPath}/calendar_localization.js" />
		<f:metadata>
 			<f:event listener="#{login.verifyUseLogin}" type="preRenderView"></f:event>
		</f:metadata>
	</h:head>

	<h:body>  
	
 		<div id="container" class="center">
	  		<div id="header" >
	  			<ui:include src="header.xhtml" />
	  		</div>
  		
	  		<div id="navigation">
                <ui:include src="global.xhtml" />              
            </div>
            
            <div id="menu" style="background-color:#FFFFFF;">
	            <ui:include src="menu.xhtml" />  
		    </div>
		    
            <p:spacer width="20" height="20" />
            
            <div id="main">
				<p:panel id="panelSearch" header="Pretraživanje obračuna" style="text-align:left;">
				<h:form id="formSearch" > 
					<table>
	                	<tr>
					    	<td class="left"><h:outputLabel for="subjekt" value="Subjekt:" /></td>  
					    	<td class="left">
					    		<p:inputText id="subjekt" value="#{obracun.subjekt}" label="subjekt"/>
					    	</td>
						</tr>
	                	<tr>
					    	<td class="left"><h:outputLabel for="datumOd" value="Datum od:" /></td>  
					    	<td class="left">
					    		<p:calendar id="datumOd" value="#{obracun.datumOd}" label="Datum od" pattern="dd.MM.yyyy"/>
					    	</td>
						</tr>
						<tr>				  
					    	<td class="left"><h:outputLabel for="datumDo" value="Datum do:" /></td>  
					    	<td class="left">
					    		<p:calendar id="datumDo" value="#{obracun.datumDo}" label="Datum do" pattern="dd.MM.yyyy"/>
					    	</td>
					  	</tr>
					  	<tr>				  
					    	<td class="left"><h:outputLabel for="pod" value="Područje:" /></td>
					    	<td class="left">
					    		<p:selectOneMenu value="#{obracun.podrucje}" id="pod">   
					            	<f:selectItem itemLabel="Odaberite" itemValue="" /> 
					            	<f:selectItem itemLabel="Životinje" itemValue="1" />  
					           	 	<f:selectItem itemLabel="Proizvodi" itemValue="2" /> 
					           	 	<f:selectItem itemLabel="Nusproizvodi" itemValue="3" />  
					           	 	<f:selectItem itemLabel="Hrana za životinje" itemValue="4" /> 
					            </p:selectOneMenu>
					    	</td>
					  	</tr>
					  	<tr>				  
					    	<td class="left"><h:outputLabel for="status" value="Status:" /></td>  
					    	<td class="left">
					    		<p:selectManyCheckbox id="status" value="#{obracun.selectedStatus}">  
						    		<f:selectItems value="#{obracun.statusi}" />  
								</p:selectManyCheckbox>
					    	</td>
					  	</tr>
					  	
					</table>
								
					<h:panelGroup id="command" layout="block" style="text-align:left !important;">
					  	<p:commandButton value="Nađi" icon="ui-icon-search" action="#{obracun.search}" update=":display"/>
						<p:commandButton value="Obriši" icon="ui-icon-refresh" actionListener="#{obracun.clear}" update=":panelSearch"/>
					</h:panelGroup>
				</h:form>	
			</p:panel>	
						
	 		<p:spacer width="20" height="20" />
	              
			<p:dialog modal="true" widgetVar="statusDialog" header="Status" draggable="false" closable="false" resizable="false">  
			    <p:graphicImage value="/img/loading.gif"/>  
			</p:dialog> 
			
			<h:panelGroup id="racuniTbl">
				<p:panel header="Arhiva obračuna" id="display">
				    <h:panelGroup id="lista">
					    <h:form prependId="false">  
						    <p:dataTable id="racuni" var="o" value="#{obracun.lazyModel}"
						    	paginator="true" rows="50"  
			          			paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"  
			          			paginatorPosition="bottom"
			          			emptyMessage="Nema podataka">  
			          			
						        <p:column id="modelHeader">  
						            <f:facet name="header">  
						                    Rbr  
						            </f:facet>  
						             
						            <h:commandLink id="viewDetail" action="#{obracun.getDetail}" >  
						            	<f:setPropertyActionListener target="#{obracun.selected}" value="#{o.idRacun}" />
			      						<h:outputText value="#{o.idRacun}" style="float:left !important"/>  
			  						</h:commandLink>
						        </p:column>  
						  
						        <p:column>  
						            <f:facet name="header">  
						                    Subjekt  
						            </f:facet>  
						            <h:outputText value="#{o.subjekt.nazivSubjekt}, #{o.subjekt.adresaSubjekt}" style="float:left !important; text-align:left !important"/>  
						        </p:column>  
						  
						        <p:column>  
						            <f:facet name="header">  
						                    Mjesec  
						            </f:facet>  
						            
						            <h:commandLink id="mjesecracuna" action="#{obracun.getDetail}" >  
						            	<f:setPropertyActionListener target="#{obracun.selected}" value="#{o.idRacun}" />
			   							<h:outputText value="#{o.datumRacuna}" style="float:left !important">
			   								<f:convertDateTime pattern="MM.yyyy" />
			   							</h:outputText>  
									</h:commandLink>
						            
						        </p:column> 
						          
						        <p:column>  
						        	<f:facet name="header">  
						                    PDF  
						            </f:facet> 
							         <h:outputLink id="detailPdf" value="#{request.contextPath}/racuni/#{o.path}">
					    				<p:graphicImage value="/img/pdf1.png" style="border:none;"/> 
					    			</h:outputLink>
						        </p:column> 
						    </p:dataTable>  
						    
						    <h:panelGroup id="genObracun" layout="block" style="margin-top:5px; text-align:left !important;">
							  	<p:commandButton value="Generiraj obračun" icon="ui-icon-document" action="#{obracun.napraviObracun}" onclick="statusDialog.show()" onstart="" oncomplete="statusDialog.hide()" update=":racuniTbl"/>
							</h:panelGroup>
							
							<div class="left" style="margin-top:10px;">
							    <h:commandLink style="margin-right:5px;">  
				    				<p:graphicImage value="/img/excel1.png" />  
				    				<p:dataExporter type="xls" target="racuni" fileName="racuni" postProcessor="#{orderSearch.postProcessXLS}" encoding="CP1250" pageOnly="true"/>  
								</h:commandLink>
					    	</div>
						</h:form>
					</h:panelGroup>    
				</p:panel>
			</h:panelGroup>
           </div>
    	
           <div id="footer">
               <ui:include src="footer.xhtml" /> 
           </div>
            
        </div>    
 	</h:body>
</html>
