<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"  
    xmlns:h="http://java.sun.com/jsf/html"  
    xmlns:f="http://java.sun.com/jsf/core" 
    xmlns:ui="http://java.sun.com/jsf/facelets"  
    xmlns:p="http://primefaces.org/ui">  
         
	<h:head>  
		<link rel="stylesheet" type="text/css" href="#{request.contextPath}/css/common.css"/>
		
		<f:metadata>
 			<f:event listener="#{login.verifyUseLogin}" type="preRenderView"></f:event>
		</f:metadata>
	</h:head>

	<h:body>  
	
 		<div id="container" class="center">
	  		<div id="header" >
	  			<ui:include src="header.xhtml" />
	  		</div>
  		
	  		<div id="navigation">
                <ui:include src="global.xhtml" />            
            </div>
            
            <div id="menu" style="background-color:#FFFFFF;">
	            <ui:include src="menu.xhtml" />  
		    </div>
		    
            <p:spacer width="20" height="20" />
            
            <div id="main">
            	
               <h:panelGroup id="certGen" layout="block">
				    <p:panel header="Ispis certifikata" id="model_view">
					    <h:form id="model_action">
						    <table>
			                	<tr>
							    	<td class="left"><h:outputLabel for="serijskibroj" value="Serijski broj:" /></td>  
							    	<td class="left"><h:outputText id="serijskibroj" value="#{issueCert.serijskiBroj}" label="Serijski broj" /></td>
								</tr>
								<tr>
							    	<td class="left"><h:outputLabel for="certifikat" value="Certifikat:" /></td>  
							    	<td class="left"><h:outputText id="certifikat" value="#{issueCert.cert.kodCertifikat}" label="Certifikat" /></td>
								</tr>
								<tr>
							    	<td class="left"></td>  
							    	<td class="left"><h:outputText id="opis" value="#{issueCert.cert.nazivCertifikat}" label="Opis" /></td>
								</tr>
								<tr>
							    	<td class="left"><h:outputLabel for="ured" value="Ured:" /></td>  
							    	<td class="left"><h:outputText id="ured" value="#{issueCert.org.name}" label="Ured" /></td>
								</tr>
								<tr>
							    	<td class="left"><h:outputLabel for="inspektor" value="Inspektor:" /></td>  
							    	<td class="left"><h:outputText id="inspektor" value="#{issueCert.ub.ime} #{issueCert.ub.prezime}" label="Inspektor" /></td>
								</tr>
								<tr>
							    	<td class="left"><h:outputLabel for="datum" value="Datum ispisa:" /></td>  
							    	<td class="left">
							    		<h:outputText id="datum" value="#{issueCert.printDate}" label="Datum ispisa" >
							    			<f:convertDateTime pattern="dd.MM.yyyy" />
							    		</h:outputText>
							    	</td>
								</tr>
								
						  	</table>
						    	
				  			<h:panelGroup id="genCertPanel" layout="block" style="text-align:left !important; margin-top:5px;">
							    <p:commandButton id="downloadLink" value="Pregled" ajax="false" rendered="#{not issueCert.modeIzrada}" actionListener="#{issueCert.prepareModelToDownload}" update="genCertPanel">  
					    			<p:fileDownload value="#{issueCert.fileDownload}" />  
								</p:commandButton>
								 
								<p:commandButton value="Odustani" icon="ui-icon-close" actionListener="#{issueCert.cancel}"/>
								
								<p:commandButton value="Generiraj" style="float:right;" actionListener="#{issueCert.izdajCertifikat}" id="prepareDoc" update=":certGen" icon="ui-icon-disk" disabled="#{issueCert.certGenerated and not issueCert.modeStorno}" rendered="#{issueCert.modeSavedCert}" onclick="statusDialog.show()" onstart="" oncomplete="statusDialog.hide()"/>  
								
								<p:commandButton value="Ispiši" style="float:right;" id="izdaj" ajax="false" rendered="#{issueCert.certGenerated}" disabled="#{issueCert.modeStorno}" actionListener="#{issueCert.prepareCertificateToDownload}" update="genCertPanel">  
									<p:fileDownload value="#{issueCert.certDownload}" />  
								</p:commandButton> 
								
								<p:commandButton id="storno" value="Storno" style="float:right;" onclick="dlg1.show();" type="button" update=":certGen, :genCertPanel" rendered="#{issueCert.certGenerated}" disabled="#{issueCert.modeStorno}"/>
							
	        					<p:growl id="messages" />  
	        					
							    <p:confirmDialog id="dialog1" message="Želite li stornirati certifikat?" header="Storniranje" severity="alert" widgetVar="dlg1">            
							        <p:commandButton id="confirm" value="Da" update="messages, :certGen" oncomplete="dlg1.hide()" actionListener="#{issueCert.storno}" />  
							        <p:commandButton id="decline" value="Ne" onclick="dlg1.hide()" type="button" />   
							    </p:confirmDialog>    
							</h:panelGroup>
					    </h:form>
				    </p:panel>
		       </h:panelGroup>		
            	
               <p:spacer width="20" height="20" />	
            	
	           <p:panel header="Podaci o izdanom certifikatu" id="panel" rendered="#{not issueCert.modeIzrada}">   
	          	 <h:form> 
                	<table>
                		<tr>
					    	<td class="left"><h:outputLabel for="d1" value="Datum:" /></td>  
					    	<td class="left"><p:calendar id="d1" value="#{issueCert.printDate}" pattern="dd.MM.yyyy" label="Datum"/></td>
						</tr>
						<tr>
					    	<td class="left"><h:outputLabel for="locType" value="Vrsta lokacije:" /></td>  
					    	<td class="left">
					    		<div>
					    			<div id="lcol" style="float:left !important;">
							    		<p:selectOneMenu id="locType" value="#{issueCert.locType}">  
							            	<f:selectItem itemLabel="Gospodarstvo" itemValue="1" />  
							            	<f:selectItem itemLabel="Objekt" itemValue="2" />  
							            	<p:ajax event="change" update="loc, :panel" listener="#{issueCert.changeType}"/>
							        	</p:selectOneMenu>
						         	</div>	
						        	<h:panelGroup id="loc" style="float:left !important;">
						        		<p:commandButton id="obtn" value="..." onclick="dlg3.show();" type="button" rendered="#{issueCert.locType == 2}" style="margin-left:2px !important;"/>   
										<p:commandButton id="fbtn" value="..." onclick="dlg4.show();" type="button" rendered="#{issueCert.locType == 1}" style="margin-left:2px !important;"/> 
						        	</h:panelGroup>
					        	</div>
					    	</td>
						</tr>					
	                	<tr>
					    	<td class="left"><h:outputLabel for="subjekt" value="Subjekt:" /></td>  
					    	<td class="left">
					    		<p:inputTextarea id="subjekt" rows="10" cols="50" value="#{issueCert.autoComplete.nazivSubjekt}" disabled="true"/>
							</td>
							<td class="left">
								<h:outputLabel for="objekt" value="VKB:" rendered="#{issueCert.locType == 2}"/>
								<h:outputLabel for="farma" value="JIBG:" rendered="#{issueCert.locType == 1}"/>
							</td>  
							<td class="left">
					    		<p:inputText id="objekt" value="#{issueCert.selObjekt.vkb}" disabled="true" rendered="#{issueCert.locType == 2}"/>
					    		<p:inputText id="farma"  value="#{issueCert.selFarma.jibg}" disabled="true" rendered="#{issueCert.locType == 1}"/>
							</td>
						</tr>
						<tr>
					    	<td class="left"><h:outputLabel for="oib" value="OIB:" /></td>  
					    	<td class="left"><p:inputText id="oib" value="#{issueCert.autoComplete.oib}" label="OIB" disabled="true"/></td>
						</tr>
						<tr>
					    	<td class="left"><h:outputLabel for="adresa" value="Adresa:" /></td>  
					    	<td class="left"><p:inputTextarea id="adresa" rows="10" cols="50" value="#{issueCert.autoComplete.adresaSubjekt}" label="Adresa" disabled="true"/></td>
						</tr>
						<tr>
					    	<td class="left"><h:outputLabel for="drzava" value="Država:" /></td>  
					    	<td class="left"><p:inputText id="drzava" value="#{issueCert.autoComplete.drzavaSubjekt}" label="Država" disabled="true"/></td>
						</tr>
				  	</table>
				 </h:form> 	
				 
				 <p:separator id="separator1"/>
				 
				 <h:panelGroup id="kilometraza" rendered="#{not issueCert.modeIzrada}">
			  	 	<h:form>
					  	<table>
	                		<tr>
						    	<td class="left"><h:outputLabel for="km1" value="Kilometraža:" /></td>  
						    	<td class="left">
						    		<p:inputText id="km1" value="#{issueCert.km}" label="Kilometraža">
						    			<f:validateLongRange minimum="0" maximum="1000"/>
						    			<p:ajax event="blur" listener="#{issueCert.postaviKm}">
						    				<f:setPropertyActionListener target="#{issueCert.km}" value="#{issueCert.km}"/>
						    			</p:ajax>
						    		</p:inputText>
						    	</td>
						    	<td class="left"><h:outputLabel for="km2" value="Odobrena kilometraža:" rendered="false"/></td>  
						    	<td class="left">
						    		<p:inputText id="km2" value="#{issueCert.odobrenaKm}" label="Odobrena kilometraža" rendered="false" readonly="true" disabled="true">
						    			<f:validateLongRange minimum="0" maximum="1000"/>
						    		</p:inputText>
						    	</td>
							</tr>
						</table>
					</h:form>
				</h:panelGroup>
				 
				 <p:separator id="separator2"/>  
				  	
			  	 <h:panelGroup id="unos" rendered="#{not issueCert.modeIzrada}">
			  	 	<h:form>
					  	<table>
	                		<tr>
						    	<td class="left"><h:outputLabel for="proizvodi" value="Proizvod:" /></td>  
						    	<td class="left">
						    		<p:inputText id="proizvodi" value="#{issueCert.selectedProizvod.nazivProizvod}" label="vrsta proizvoda" disabled="true"/>
						    		<p:commandButton id="basic4" value="Uredi" icon="ui-icon-document" onclick="dlg2.show();" type="button"/>
	        						<p:tooltip for="basic4" value="Odaberite proizvode" showEvent="focus" hideEvent="blur" />
						    	</td>
							</tr>
							<tr>
								<td class="left"><h:outputLabel for="mjera" value="Mjera:" /></td>  
								<td class="left">
									<p:selectOneMenu id="mjera" value="#{issueCert.selectedMjera}" effect="fade" style="vertical-align:middle;">  
		            					<f:selectItems value="#{issueCert.mjeraList}"/>
		        					</p:selectOneMenu> 
								</td>
							</tr>
		                	<tr>
								<td class="left"><h:outputLabel for="kolicina" value="Količina:" /></td>  
								<td class="left">
									<p:inputText id="kolicina" value="#{issueCert.kolicina}" label="Količina" />	
								</td>
							</tr>
					  	</table>
					  	
					  	<h:panelGroup id="unos_cmd" layout="block" style="text-align:left !important; margin-top:5px;">
							<p:commandButton value="Dodaj" actionListener="#{issueCert.add}" update=":unostbl, :unos" disabled="#{issueCert.modeSavedCert}"/>
							<p:commandButton value="Obriši" icon="ui-icon-close" actionListener="#{issueCert.reset}" update=":unos" disabled="#{issueCert.modeSavedCert}"/>
							<p:commandButton value="Spremi" style="float:right;" actionListener="#{issueCert.save}" id="prepareDoc" icon="ui-icon-disk" update=":certGen, :unos, :unostbl" rendered="#{not issueCert.modeSavedCert}" onclick="statusDialog.show()" onstart="" oncomplete="statusDialog.hide()"/>  
						</h:panelGroup>
					  	
					</h:form>
				</h:panelGroup>
				
				<p:spacer width="20" height="20" />
				
				<h:panelGroup id="unostbl">
					<h:form>
					  	<p:dataTable id="proizvodiCert" var="o" value="#{issueCert.listaSelCertProd}"
					    	paginator="true" rows="50"  
	           				paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"  
	           				paginatorPosition="bottom"
	           				emptyMessage="Nema podataka">  
					        
					        <p:column>  
					            <f:facet name="header">  
					                    Naziv 
					            </f:facet>  
					            <h:outputText value="#{o.prod.nazivProizvod}" style="float:left !important"/>  
					        </p:column>
					        
					        <p:column>  
					            <f:facet name="header">  
					                    Mjera 
					            </f:facet>  
					            <h:outputText value="#{o.nazivMjera}" style="float:left !important"/>  
					        </p:column>
					        
					        <p:column>  
					            <f:facet name="header">  
					                    Količina 
					            </f:facet>  
					            <h:outputText value="#{o.kolicina}" style="float:left !important"/>  
					        </p:column>
					        
					        <p:column>  
					            <h:commandLink action="#{issueCert.delete}" rendered="#{not issueCert.modeSavedCert}">
					            	<f:setPropertyActionListener target="#{issueCert.selected}" value="#{o.id}" />
			    					<p:graphicImage value="/img/close2.png"/> 
			    				</h:commandLink>
					        </p:column> 
						</p:dataTable>
					</h:form>
				</h:panelGroup>
			</p:panel> 
				
			<p:dialog id="dialog2" header="Odabir proizvoda" widgetVar="dlg2" dynamic="true">  
				    
			  	<p:panel header="Proizvodi" id="display2d">
			    	<h:form prependId="false">  
					    <p:dataTable var="o" value="#{issueCert.proizvodiList}"
					    	paginator="true" rows="10"  
            				paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"  
            				paginatorPosition="bottom"
            				emptyMessage="Nema podataka"
            				rowKey="#{o.idProizvod}"
            				filterEvent="enter"
            				selectionMode="single"
            				selection="#{issueCert.selectedProizvod}"
            				draggable="false"
            				resizable="false">  
            				
            				<p:ajax event="rowSelect" update=":panel" oncomplete="dlg2.hide()" listener="#{issueCert.handleClose2}"/>
            				
					        <p:column id="modelHeader" filterBy="#{o.idProizvod}" filterMatchMode="contains">  
					            <f:facet name="header">  
					                    ID  
					            </f:facet>  
					           	<h:outputText value="#{o.idProizvod}" style="float:left !important"/>  
					        </p:column>
					          
					  		<p:column filterBy="#{o.kodProizvod}" filterMatchMode="contains">  
					            <f:facet name="header">  
					                    Tarifna oznaka 
					            </f:facet>  
					            <h:outputText value="#{o.kodProizvod}" style="float:left !important"/>  
					        </p:column>
					         
					        <p:column filterBy="#{o.nazivProizvod}" filterMatchMode="contains">  
					            <f:facet name="header">  
					                    Naziv 
					            </f:facet>  
					            <h:outputText value="#{o.nazivProizvod}" style="float:left !important"/>  
					        </p:column>  
					    </p:dataTable>  
					    
					</h:form>    
				</p:panel>  
			</p:dialog>
			
			
			<p:dialog id="estDialog" header="Odabir objekta" widgetVar="dlg3" dynamic="true">  
				    
			  	<p:panel header="Objekti" id="displayObjekti">
			    	<h:form prependId="false">  
					    <p:dataTable var="o" value="#{objekt.lazyModel}"
					    	paginator="true" rows="10"  
            				paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"  
            				paginatorPosition="bottom"
            				emptyMessage="Nema podataka"
            				rowKey="#{o.idObjekt}"
            				filterEvent="enter"
            				selectionMode="single"
            				selection="#{issueCert.selObjekt}"
            				draggable="false"
            				resizable="false">  
            				
            				<p:ajax event="rowSelect" update=":panel" oncomplete="dlg3.hide()" listener="#{issueCert.handleSelect2}"/>
            				
					  		<p:column filterBy="#{o.objekt}" filterMatchMode="contains">  
					            <f:facet name="header">  
					                    Objekt 
					            </f:facet>  
					            <h:outputText value="#{o.objekt}" style="float:left !important"/>  
					        </p:column>
					         
					        <p:column filterBy="#{o.vkb}" filterMatchMode="contains">  
					            <f:facet name="header">  
					                    VKB 
					            </f:facet>  
					            <h:outputText value="#{o.vkb}" style="float:left !important"/>  
					        </p:column> 
					        
					        <p:column filterBy="#{o.subjekt}" filterMatchMode="contains">  
					            <f:facet name="header">  
					                    Subjekt 
					            </f:facet>  
					            <h:outputText value="#{o.subjekt}" style="float:left !important"/>  
					        </p:column>
					         
					        <p:column filterBy="#{o.oib}" filterMatchMode="contains">  
					            <f:facet name="header">  
					                    OIB 
					            </f:facet>  
					            <h:outputText value="#{o.oib}" style="float:left !important"/>  
					        </p:column> 
					         
					    </p:dataTable>  
					    
					</h:form>    
				</p:panel>  
			</p:dialog>
			
			<p:dialog id="farmDialog" header="Odabir gospodarstva" widgetVar="dlg4" dynamic="true">  
				    
			  	<p:panel header="Gospodarstva" id="displayFarme">
			    	<h:form prependId="false">  
					    <p:dataTable var="o" value="#{farma.lazyModel}"
					    	paginator="true" rows="10"  
            				paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"  
            				paginatorPosition="bottom"
            				emptyMessage="Nema podataka"
            				filterEvent="enter"
            				rowKey="#{o.idLocation}"
            				selectionMode="single"
            				selection="#{issueCert.selFarma}"
            				draggable="false"
            				resizable="false">  
            				
            				<p:ajax event="rowSelect" update=":panel" oncomplete="dlg4.hide()" listener="#{issueCert.handleSelect1}"/>
            				
					  		<p:column filterBy="#{o.jibg}" filterMatchMode="contains">  
					            <f:facet name="header" >  
					                    JIBG
					            </f:facet>  
					            <h:outputText value="#{o.jibg}" style="float:left !important"/>  
					        </p:column> 
					        
					        <p:column filterBy="#{o.ime}" filterMatchMode="contains">  
					            <f:facet name="header" >  
					                    Ime
					            </f:facet>  
					            <h:outputText value="#{o.ime}" style="float:left !important"/>  
					        </p:column> 
					        
					        <p:column filterBy="#{o.prezime}" filterMatchMode="contains">  
					            <f:facet name="header" >  
					                    Prezime
					            </f:facet>  
					            <h:outputText value="#{o.prezime}" style="float:left !important"/>  
					        </p:column> 
					        
					        <p:column filterBy="#{o.naziv}" filterMatchMode="contains">  
					            <f:facet name="header">  
					                    Naziv 
					            </f:facet>  
					            <h:outputText value="#{o.naziv}" style="float:left !important"/>  
					        </p:column>  
					        
					        <p:column filterBy="#{o.oib}" filterMatchMode="contains">  
					            <f:facet name="header" >  
					                    OIB 
					            </f:facet>  
					            <h:outputText value="#{o.oib}" style="float:left !important"/>  
					        </p:column>
					        
					    </p:dataTable>  
					    
					</h:form>    
				</p:panel>  
			</p:dialog>
			
			<p:dialog modal="true" widgetVar="statusDialog" header="Status" draggable="false" closable="false" resizable="false">  
			    <p:graphicImage value="/img/loading.gif"/>  
			</p:dialog> 
			
            </div>
    	
           <div id="footer">
               <ui:include src="footer.xhtml" /> 
           </div>
            
        </div>    
 	</h:body>
</html>
